// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}


///////////////////////
// ENUMS
///////////////////////

enum CycleStatus {
  ACTIVE
  COMPLETED
}

enum TaskStatus {
  PENDING
  COMPLETED
  MISSED
}

enum RecurrenceFrequency {
  DAILY
  WEEKLY
}

///////////////////////
// MODELS
///////////////////////

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  cycles    Cycle[]
  goals     Goal[]
  tasks     Task[]
  categories GoalCategory[]
  recurringTaskTemplates RecurringTaskTemplate[]
}

model Cycle {
  id        String      @id @default(uuid())
  userId    String
  status    CycleStatus @default(ACTIVE)

  startDate DateTime
  endDate   DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   User   @relation(fields: [userId], references: [id])
  weeks  Week[]
  goals  Goal[]
}

model Week {
  id        String   @id @default(uuid())
  cycleId  String

  weekIndex Int      // 1..12 (or configurable)
  startDate DateTime
  endDate   DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  cycle Cycle @relation(fields: [cycleId], references: [id])
  tasks Task[]
}

model Goal {
  id          String   @id @default(uuid())
  userId      String
  cycleId     String
  categoryId  String?

  title       String
  description String?

  manuallyCompleted Boolean @default(false)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user     User          @relation(fields: [userId], references: [id])
  cycle    Cycle         @relation(fields: [cycleId], references: [id])
  category GoalCategory? @relation(fields: [categoryId], references: [id])
  tasks    Task[]
  recurringTaskTemplates RecurringTaskTemplate[]
}

model GoalCategory {
  id        String   @id @default(uuid())
  userId    String

  name      String
  color     String?  // Ãºtil para dashboard no futuro

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user  User   @relation(fields: [userId], references: [id])
  goals Goal[]
}

model Task {
  id        String     @id @default(uuid())
  userId    String
  weekId    String
  goalId    String?

  title     String
  status    TaskStatus @default(PENDING)

  plannedDate  DateTime?
  completedAt  DateTime?
  completedLate Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id])
  week Week @relation(fields: [weekId], references: [id])
  goal Goal? @relation(fields: [goalId], references: [id])
}

model RecurringTaskTemplate {
  id        String   @id @default(uuid())
  userId    String
  goalId    String?

  title     String

  // Recurrence definition
  frequency RecurrenceFrequency
  interval  Int      @default(1) // every X weeks/days
  daysOfWeek Int[]   // 1 = Monday ... 7 = Sunday (optional)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id])
  goal Goal? @relation(fields: [goalId], references: [id])
}

